git clone https://github.com/faucetsdn/faucetagent.git

cd faucetagent/
./dependencies.sh

apt install golang-go -y 
export PATH=$PATH:$HOME/go/bin
export GOPATH=$HOME/go
go get github.com/google/gnxi/gnmi_capabilities
go install github.com/google/gnxi/gnmi_capabilities
go get github.com/google/gnxi/gnmi_set
go get github.com/google/gnxi/gnmi_get


# Generating fake CA cert
mkdir -p tls_cert_key

mkdir -p tls_cert_key/server
openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls_cert_key/server/server.key -out tls_cert_key/server/server.crt  -subj '/CN=faucet.localhost'

mkdir -p tls_cert_key/client
openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls_cert_key/client/client.key -out tls_cert_key/client/client.crt  -subj '/CN=bro.localhost'
Oo
cp tls_cert_key/server/server.crt tls_cert_key/client/ca.crt

make

# faucet server side
./faucetagent.py --cert tls_cert_key/server/server.crt  --key tls_cert_key/server/server.key --configfile /etc/faucet/faucet.yaml 


# Bro client side 
AUTH="-ca tls_cert_key/client/ca.crt -cert tls_cert_key/client/client.crt -key tls_cert_key/client/client.key -target_name faucet.localhost"
gnmi_capabilities $AUTH
string_val() { grep string_val: | awk -F 'string_val: "' '{printf $2;}'  | sed -e 's/"$//' | xargs -0 printf; }
gnmi_get $AUTH -xpath=/ | string_val
-------------------------------


#---------------------------
git clone https://github.com/faucetsdn/faucetagent.git

cd faucetagent/

./dependencies.sh
./test-dependencies.sh

# Generating fake CA cert
openssl req -x509 -sha256 -nodes -days 2 -newkey rsa:2048 -keyout fakeca.key -out fakeca.crt  -subj '/CN=localhost'

Generating and signing fake server cert
openssl genrsa -out fakeserver.key 2048
openssl req -new -key fakeserver.key -out fakeserver.csr -subj '/CN=localhost'
openssl x509 -req -days 2 -in fakeserver.csr -CA fakeca.crt -CAkey fakeca.key -set_serial 01 -out fakeserver.crt

Generating fake client CA cert (self-signed)
openssl req -x509 -sha256 -nodes -days 2 -newkey rsa:2048 -keyout fakeclient.key -out fakeclient.crt -subj '/CN=localhost'


sudo ./faucetagent.py --cert cert_dir/server_cert/fakeca.crt  --key cert_dir/server_cert/fakeca.key --configfile /etc/faucet/faucet.yaml 



client
AUTH="-ca cert_dir/server_cert/fakeca.crt -cert cert_dir/client_cert/fakeclient.crt -key cert_dir/client_cert/fakeclient.key -target_name localhost"
go get github.com/google/gnxi/gnmi_capabilities
go install github.com/google/gnxi/gnmi_capabilities
export PATH=$PATH:/home/moh/go/bin/
gnmi_capabilities $AUTH
string_val() { grep string_val: | awk -F 'string_val: "' '{printf $2;}'  | sed -e 's/"$//' | xargs -0 printf; }

